<div class="login-container">
  <div class="login-wrapper">
    <!-- Sección izquierda: Formulario -->
    <div class="login-form-section">
      <div class="login-form-content">
        <div class="login-header">
          <div class="login-logo">
            <img
              src="/assets/esther-logo.png"
              alt="Esther Logo"
              class="login-logo-img"
            />
          </div>
          <h1>Restablecer Contraseña</h1>
          <p>Ingresa tu nueva contraseña</p>
        </div>

        @if (!token() || !email()) {
          <div class="error-message">
            {{ error() || 'Token o email no válidos. Redirigiendo...' }}
          </div>
        } @else {
          <div class="info-message">
            <p>
              <strong>Restableciendo contraseña para:</strong><br />
              <span class="email-display">{{ email() }}</span>
            </p>
          </div>

          <form
            [formGroup]="resetForm"
            (ngSubmit)="onSubmit()"
            class="login-form"
          >
            @if (error()) {
              <div class="error-message">{{ error() }}</div>
            }

            <div class="form-group">
              <label for="password">Nueva Contraseña</label>
              <div class="password-input-wrapper">
                <input
                  id="password"
                  [type]="showPassword() ? 'text' : 'password'"
                  formControlName="password"
                  placeholder="••••••••"
                  [class.invalid]="
                    resetForm.get('password')?.invalid &&
                    resetForm.get('password')?.touched
                  "
                />
                <button
                  type="button"
                  class="password-toggle"
                  (click)="togglePasswordVisibility()"
                  [attr.aria-label]="
                    showPassword() ? 'Ocultar contraseña' : 'Mostrar contraseña'
                  "
                >
                  <lucide-icon
                    [img]="showPassword() ? icons.EyeOff : icons.Eye"
                    [size]="18"
                  ></lucide-icon>
                </button>
              </div>
              @if (resetForm.get('password')?.invalid &&
              resetForm.get('password')?.touched) {
              <span class="error-text">
                @if (passwordErrors.minLength) {
                  La contraseña debe tener mínimo 6 caracteres
                } @else if (passwordErrors.uppercase) {
                  La contraseña debe contener al menos una mayúscula
                } @else if (passwordErrors.lowercase) {
                  La contraseña debe contener al menos una minúscula
                } @else if (passwordErrors.specialChar) {
                  La contraseña debe contener al menos un carácter especial
                } @else {
                  Contraseña requerida
                }
              </span>
              }
            </div>

            <div class="form-group mt-4">
              <label for="confirmPassword">Confirmar Contraseña</label>
              <div class="password-input-wrapper">
                <input
                  id="confirmPassword"
                  [type]="showConfirmPassword() ? 'text' : 'password'"
                  formControlName="confirmPassword"
                  placeholder="••••••••"
                  [class.invalid]="
                    passwordsDoNotMatch ||
                    (resetForm.get('confirmPassword')?.invalid &&
                    resetForm.get('confirmPassword')?.touched)
                  "
                />
                <button
                  type="button"
                  class="password-toggle"
                  (click)="toggleConfirmPasswordVisibility()"
                  [attr.aria-label]="
                    showConfirmPassword() ? 'Ocultar contraseña' : 'Mostrar contraseña'
                  "
                >
                  <lucide-icon
                    [img]="showConfirmPassword() ? icons.EyeOff : icons.Eye"
                    [size]="18"
                  ></lucide-icon>
                </button>
              </div>
              @if (passwordsDoNotMatch) {
              <span class="error-text">Las contraseñas no coinciden</span>
              } @else if (resetForm.get('confirmPassword')?.invalid &&
              resetForm.get('confirmPassword')?.touched) {
              <span class="error-text">Confirmar contraseña requerida</span>
              }
            </div>

            <button
              type="submit"
              class="btn-primary"
              [disabled]="resetForm.invalid || isLoading()"
            >
              @if (isLoading()) {
              <span>Restableciendo...</span>
              } @else {
              <span>Restablecer Contraseña</span>
              }
            </button>
          </form>
        }

        <div class="form-actions">
          <a routerLink="/login" class="forgot-link">
            ← Volver al inicio de sesión
          </a>
        </div>
      </div>
    </div>

    <!-- Sección derecha: Imagen -->
    <div class="login-image-section">
      <div class="login-image-wrapper">
        <img
          src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=1200&h=1600&fit=crop&q=80"
          alt="Esther Platform"
          class="login-image"
        />
      </div>
    </div>
  </div>
</div>
