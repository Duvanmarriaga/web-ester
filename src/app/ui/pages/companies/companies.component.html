<div class="container-fluid py-3">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="page-title">Gestión de Compañías</h1>
    <button class="btn btn-sm btn-primary d-flex align-items-center gap-2" (click)="openCreateModal()">
      <lucide-icon [img]="icons.Building2" [size]="16"></lucide-icon>
      <span>Nueva Compañía</span>
    </button>
  </div>

  <!-- Loading -->
  @if (isLoading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  } @else {
    <!-- Companies Grid - Diseño compacto y moderno -->
    <div class="row g-2">
      @for (company of companies(); track company.id) {
        <div class="col-xxl-3 col-xl-4 col-lg-4 col-md-6 col-12">
          <div class="company-card">
            <!-- Card Header -->
            <div class="company-header">
              <div class="d-flex align-items-center gap-2 flex-grow-1">
                <div class="company-avatar">
                  <lucide-icon [img]="icons.Building2" [size]="16"></lucide-icon>
                </div>
                <div class="company-info flex-grow-1 min-w-0">
                  <h6 class="company-name mb-0">{{ company.name }}</h6>
                  <small class="company-nit text-muted">{{ company.identification_number }}</small>
                </div>
              </div>
            </div>

            <!-- Card Body - Información compacta -->
            <div class="company-body">
              <div class="info-row">
                <lucide-icon [img]="icons.Mail" [size]="12" class="info-icon"></lucide-icon>
                <span class="info-text">{{ company.email }}</span>
              </div>
              @if (company.phone) {
                <div class="info-row">
                  <lucide-icon [img]="icons.Phone" [size]="12" class="info-icon"></lucide-icon>
                  <span class="info-text">{{ company.phone }}</span>
                </div>
              }
              <div class="info-row">
                <lucide-icon [img]="icons.MapPin" [size]="12" class="info-icon"></lucide-icon>
                <span class="info-text text-truncate">{{ company.address }}</span>
              </div>
            </div>

            <!-- Card Actions -->
            <div class="company-actions">
              <button class="action-btn edit-btn" (click)="openEditModal(company)" title="Editar">
                <lucide-icon [img]="icons.Pencil" [size]="12"></lucide-icon>
              </button>
              <button class="action-btn delete-btn" (click)="deleteCompany(company)" title="Eliminar">
                <lucide-icon [img]="icons.Trash2" [size]="12"></lucide-icon>
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Modal -->
  @if (showModal()) {
    <div class="modal show d-block">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              {{ editingCompany() ? 'Editar Compañía' : 'Nueva Compañía' }}
            </h5>
            <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form [formGroup]="companyForm" (ngSubmit)="onSubmit()">
              <div class="mb-3">
                <label for="name" class="form-label">Nombre de la Compañía</label>
                <input type="text" class="form-control" id="name" formControlName="name" placeholder="Empresa S.A.">
                @if (companyForm.get('name')?.invalid && companyForm.get('name')?.touched) {
                  <small class="form-error">Nombre requerido</small>
                }
              </div>
              <div class="mb-3">
                <label for="identification_number" class="form-label">Número de Identificación</label>
                <input type="text" class="form-control" id="identification_number" formControlName="identification_number" placeholder="123456789">
                @if (companyForm.get('identification_number')?.invalid && companyForm.get('identification_number')?.touched) {
                  <small class="form-error">Número de identificación requerido</small>
                }
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" formControlName="email" placeholder="contacto@empresa.com">
                @if (companyForm.get('email')?.invalid && companyForm.get('email')?.touched) {
                  <small class="form-error">Email válido requerido</small>
                }
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">Teléfono <span class="text-muted">(Opcional)</span></label>
                <input type="tel" class="form-control" id="phone" formControlName="phone" placeholder="+57 300 123 4567">
              </div>
              <div class="mb-3">
                <label for="address" class="form-label">Dirección</label>
                <textarea class="form-control" id="address" formControlName="address" rows="2" placeholder="Calle 123 #45-67"></textarea>
                @if (companyForm.get('address')?.invalid && companyForm.get('address')?.touched) {
                  <small class="form-error">Dirección requerida</small>
                }
              </div>
              <div class="d-flex gap-2 justify-content-end mt-4">
                <button type="button" class="btn btn-sm btn-outline-secondary" (click)="closeModal()">
                  Cancelar
                </button>
                <button type="submit" class="btn btn-sm btn-primary" [disabled]="companyForm.invalid">
                  {{ editingCompany() ? 'Actualizar' : 'Crear' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  }
  
  <!-- Confirm Dialog -->
  <app-confirm-dialog
    [isVisible]="showConfirmDialog()"
    [title]="'Eliminar Compañía'"
    [message]="getDeleteMessage()"
    [confirmText]="'Eliminar'"
    [cancelText]="'Cancelar'"
    [variant]="'danger'"
    (confirmed)="confirmDelete()"
    (cancelled)="cancelDelete()"
  />
</div>
